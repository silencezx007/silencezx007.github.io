<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ÂÆûÊó∂ÁøªËØëÂ∫îÁî® - ‰∏≠Ëë°Ëã±‰∫íËØë</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a24;
            --border-color: #2a2a3a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --accent-blue: #3b82f6;
            --accent-blue-hover: #2563eb;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-orange: #f59e0b;
            --accent-purple: #8b5cf6;
            --gradient-blue: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Header */
        .header {
            padding: 1.5rem 1rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            background: var(--gradient-blue);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.25rem;
        }

        .header p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Main Container */
        .container {
            max-width: 640px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Auto Detect Info */
        .auto-detect-info {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1rem 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .auto-detect-icon {
            width: 24px;
            height: 24px;
            color: var(--accent-blue);
        }

        .auto-detect-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .detected-lang {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.35rem 0.75rem;
            background: rgba(59, 130, 246, 0.15);
            border-radius: 8px;
            color: var(--accent-blue);
            font-weight: 500;
            font-size: 0.85rem;
            margin-left: 0.5rem;
        }

        .detected-lang.hidden {
            display: none;
        }

        /* Record Button */
        .record-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 2rem 0;
        }

        .record-btn {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid var(--accent-blue);
            background: linear-gradient(145deg, var(--bg-card), var(--bg-secondary));
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.2);
        }

        .record-btn::before {
            content: '';
            position: absolute;
            inset: -8px;
            border-radius: 50%;
            border: 2px solid transparent;
            background: linear-gradient(135deg, var(--accent-blue), transparent) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .record-btn:hover::before {
            opacity: 1;
        }

        .record-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 50px rgba(59, 130, 246, 0.4);
        }

        .record-btn.recording {
            border-color: var(--accent-red);
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 50px rgba(239, 68, 68, 0.4);
        }

        .record-btn.recording .mic-icon {
            color: var(--accent-red);
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.08);
            }
        }

        .mic-icon {
            width: 36px;
            height: 36px;
            color: var(--accent-blue);
            transition: color 0.3s ease;
        }

        .record-hint {
            margin-top: 1rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .recording-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--accent-red);
            font-weight: 500;
        }

        .recording-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-red);
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        /* Result Cards */
        .result-section {
            margin-bottom: 1rem;
        }

        .result-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid var(--border-color);
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .result-card:hover {
            border-color: rgba(59, 130, 246, 0.3);
        }

        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .result-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lang-tag {
            padding: 0.25rem 0.5rem;
            background: rgba(59, 130, 246, 0.15);
            border-radius: 4px;
            color: var(--accent-blue);
            font-size: 0.7rem;
            font-weight: 600;
        }

        .lang-tag.zh {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
        }

        .lang-tag.en {
            background: rgba(16, 185, 129, 0.15);
            color: var(--accent-green);
        }

        .lang-tag.pt {
            background: rgba(139, 92, 246, 0.15);
            color: var(--accent-purple);
        }

        .result-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            background: rgba(59, 130, 246, 0.1);
        }

        .action-btn.speaking {
            border-color: var(--accent-green);
            color: var(--accent-green);
            background: rgba(16, 185, 129, 0.1);
            animation: speakPulse 1s infinite;
        }

        @keyframes speakPulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        .action-btn svg {
            width: 18px;
            height: 18px;
        }

        .result-text {
            font-size: 1.1rem;
            line-height: 1.7;
            color: var(--text-primary);
            min-height: 50px;
        }

        .result-text.placeholder {
            color: var(--text-secondary);
            font-style: italic;
        }

        .result-text.large {
            font-size: 1.3rem;
            font-weight: 500;
        }

        /* Translation Cards with accent borders */
        .translation-card {
            position: relative;
            overflow: hidden;
        }

        .translation-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            border-radius: 4px 0 0 4px;
        }

        .translation-card.zh::before {
            background: linear-gradient(180deg, #ef4444, #f87171);
        }

        .translation-card.en::before {
            background: linear-gradient(180deg, #10b981, #34d399);
        }

        .translation-card.pt::before {
            background: linear-gradient(180deg, #8b5cf6, #a78bfa);
        }

        /* History Section */
        .history-section {
            margin-top: 2rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .clear-btn {
            font-size: 0.75rem;
            color: var(--text-secondary);
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .clear-btn:hover {
            color: var(--accent-red);
            background: rgba(239, 68, 68, 0.1);
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .history-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .history-item:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }

        .history-original {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .history-translations {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .history-trans-item {
            font-size: 0.85rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .history-trans-item .mini-tag {
            font-size: 0.65rem;
            padding: 0.15rem 0.35rem;
            border-radius: 3px;
        }

        .history-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Status Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-color: var(--accent-green);
        }

        .toast.error {
            border-color: var(--accent-red);
        }

        .toast-icon {
            width: 20px;
            height: 20px;
        }

        .toast.success .toast-icon {
            color: var(--accent-green);
        }

        .toast.error .toast-icon {
            color: var(--accent-red);
        }

        /* API Key Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            border: 1px solid var(--border-color);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal {
            transform: scale(1);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .modal-desc {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        .input-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            display: block;
        }

        .input-field {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: border-color 0.2s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .modal-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .btn {
            flex: 1;
            padding: 0.875rem 1.5rem;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            border-color: var(--text-secondary);
            color: var(--text-primary);
        }

        .btn-primary {
            background: var(--gradient-blue);
            border: none;
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* Settings Button */
        .settings-btn {
            position: fixed;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 100;
        }

        .settings-btn:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .settings-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .empty-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.25rem;
            }

            .record-btn {
                width: 90px;
                height: 90px;
            }

            .mic-icon {
                width: 32px;
                height: 32px;
            }

            .result-text {
                font-size: 1rem;
            }

            .result-text.large {
                font-size: 1.15rem;
            }
        }

        /* Auto-speak toggle */
        .auto-speak-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 1rem;
            padding: 0.75rem;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .toggle-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 26px;
            background: var(--bg-secondary);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .toggle-switch.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(22px);
        }
    </style>
</head>

<body>
    <!-- Settings Button -->
    <button class="settings-btn" onclick="showApiKeyModal()" title="ËÆæÁΩÆ API">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
    </button>

    <!-- Header -->
    <header class="header">
        <h1>üéôÔ∏è AI ÂÆûÊó∂ÁøªËØë</h1>
        <p>ÂÆâÂì•ÊãâÊú∫Âú∫ËøêÁª¥ ¬∑ ‰∏≠Ëë°Ëã±‰∫íËØë</p>
    </header>

    <main class="container">
        <!-- Auto Detect Info -->
        <div class="auto-detect-info">
            <svg class="auto-detect-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
            <span class="auto-detect-text">Ëá™Âä®Ê£ÄÊµãËØ≠Ë®Ä</span>
            <span class="detected-lang hidden" id="detectedLang">
                <span id="detectedLangText">‰∏≠Êñá</span>
            </span>
        </div>

        <!-- Record Button -->
        <div class="record-section">
            <button class="record-btn" id="recordBtn" onclick="toggleRecording()">
                <svg class="mic-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                </svg>
            </button>
            <div class="record-hint" id="recordHint">ÁÇπÂáªÂºÄÂßãÂΩïÈü≥ÔºàÊîØÊåÅ‰∏≠/Ëã±/Ëë°ËØ≠Ôºâ</div>
        </div>

        <!-- Auto Speak Toggle -->
        <div class="auto-speak-toggle">
            <span class="toggle-label">üîä Ëá™Âä®ÊúóËØªÁøªËØëÁªìÊûú</span>
            <div class="toggle-switch" id="autoSpeakToggle" onclick="toggleAutoSpeak()"></div>
        </div>

        <!-- Result Cards -->
        <div class="result-section">
            <!-- Original Text -->
            <div class="result-card" id="originalCard">
                <div class="result-header">
                    <span class="result-label">
                        ÂéüÊñá
                        <span class="lang-tag" id="originalLangTag">Ëá™Âä®Ê£ÄÊµã</span>
                    </span>
                    <div class="result-actions">
                        <button class="action-btn" id="originalSpeakBtn" onclick="speakText('original')" title="ÊúóËØª">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                            </svg>
                        </button>
                        <button class="action-btn" onclick="copyText('original')" title="Â§çÂà∂">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="result-text placeholder" id="originalText">Á≠âÂæÖËØ≠Èü≥ËæìÂÖ•...</div>
            </div>

            <!-- Translation 1 -->
            <div class="result-card translation-card en" id="trans1Card">
                <div class="result-header">
                    <span class="result-label">
                        ËØëÊñá
                        <span class="lang-tag en" id="trans1LangTag">Ëã±ËØ≠</span>
                    </span>
                    <div class="result-actions">
                        <button class="action-btn" id="trans1SpeakBtn" onclick="speakText('trans1')" title="ÊúóËØª">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                            </svg>
                        </button>
                        <button class="action-btn" onclick="copyText('trans1')" title="Â§çÂà∂">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="result-text large placeholder" id="trans1Text">ÁøªËØëÁªìÊûúÂ∞ÜÂú®Ê≠§ÊòæÁ§∫...</div>
            </div>

            <!-- Translation 2 -->
            <div class="result-card translation-card pt" id="trans2Card">
                <div class="result-header">
                    <span class="result-label">
                        ËØëÊñá
                        <span class="lang-tag pt" id="trans2LangTag">Ëë°ËêÑÁâôËØ≠</span>
                    </span>
                    <div class="result-actions">
                        <button class="action-btn" id="trans2SpeakBtn" onclick="speakText('trans2')" title="ÊúóËØª">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                            </svg>
                        </button>
                        <button class="action-btn" onclick="copyText('trans2')" title="Â§çÂà∂">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="result-text large placeholder" id="trans2Text">ÁøªËØëÁªìÊûúÂ∞ÜÂú®Ê≠§ÊòæÁ§∫...</div>
            </div>
        </div>

        <!-- History Section -->
        <div class="history-section">
            <div class="section-header">
                <span class="section-title">üìã ÂéÜÂè≤ËÆ∞ÂΩï</span>
                <button class="clear-btn" onclick="clearHistory()">Ê∏ÖÁ©∫</button>
            </div>
            <div class="history-list" id="historyList">
                <div class="empty-state">
                    <svg class="empty-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                    <p>ÊöÇÊó†ÁøªËØëËÆ∞ÂΩï</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast -->
    <div class="toast" id="toast">
        <svg class="toast-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <span id="toastMessage">Êìç‰ΩúÊàêÂäü</span>
    </div>

    <!-- API Key Modal -->
    <div class="modal-overlay" id="apiKeyModal">
        <div class="modal">
            <h2 class="modal-title">‚öôÔ∏è API ËÆæÁΩÆ</h2>
            <p class="modal-desc">ÈÖçÁΩÆÁøªËØëÊúçÂä° APIÔºà‰ΩøÁî® Google Gemini APIÔºâ</p>

            <div class="input-group">
                <label class="input-label" for="apiKeyInput">Gemini API Key</label>
                <input type="password" class="input-field" id="apiKeyInput" placeholder="ËæìÂÖ•‰Ω†ÁöÑ Gemini API Key">
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="hideApiKeyModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="saveApiKey()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <script>
        // State
        let isRecording = false;
        let detectedLang = null; // zh, pt, en
        let recognition = null;
        let history = [];
        let apiKey = localStorage.getItem('gemini_api_key') || '';
        let autoSpeak = localStorage.getItem('auto_speak') === 'true';
        let currentTexts = { original: '', trans1: '', trans2: '' };
        let currentLangs = { original: '', trans1: '', trans2: '' };

        // Language display names
        const langNames = {
            'zh': '‰∏≠Êñá',
            'pt': 'Ëë°ËêÑÁâôËØ≠',
            'en': 'Ëã±ËØ≠'
        };

        const langCodes = {
            'zh': 'zh-CN',
            'pt': 'pt-PT',
            'en': 'en-US'
        };

        const langFlags = {
            'zh': 'üá®üá≥',
            'pt': 'üáµüáπ',
            'en': 'üá¨üáß'
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadHistory();
            updateAutoSpeakUI();

            // Check if API key is set
            if (!apiKey) {
                setTimeout(() => showApiKeyModal(), 500);
            }

            // Initialize Speech Recognition
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                // Use multi-language detection
                recognition.lang = 'zh-CN'; // Default, will try to detect

                recognition.onresult = handleSpeechResult;
                recognition.onerror = handleSpeechError;
                recognition.onend = handleSpeechEnd;
            } else {
                showToast('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ËØÜÂà´', 'error');
            }
        });

        // Toggle auto speak
        function toggleAutoSpeak() {
            autoSpeak = !autoSpeak;
            localStorage.setItem('auto_speak', autoSpeak);
            updateAutoSpeakUI();
        }

        function updateAutoSpeakUI() {
            const toggle = document.getElementById('autoSpeakToggle');
            toggle.classList.toggle('active', autoSpeak);
        }

        // Toggle recording
        function toggleRecording() {
            if (!recognition) {
                showToast('ËØ≠Èü≥ËØÜÂà´‰∏çÂèØÁî®', 'error');
                return;
            }

            if (!apiKey) {
                showApiKeyModal();
                showToast('ËØ∑ÂÖàËÆæÁΩÆ API Key', 'error');
                return;
            }

            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        // Start recording
        function startRecording() {
            isRecording = true;
            detectedLang = null;
            const recordBtn = document.getElementById('recordBtn');
            const recordHint = document.getElementById('recordHint');

            recordBtn.classList.add('recording');
            recordHint.innerHTML = '<div class="recording-status"><span class="recording-dot"></span>Ê≠£Âú®ÂΩïÈü≥...</div>';

            // Reset detected language display
            document.getElementById('detectedLang').classList.add('hidden');

            recognition.start();
        }

        // Stop recording
        function stopRecording() {
            isRecording = false;
            const recordBtn = document.getElementById('recordBtn');
            const recordHint = document.getElementById('recordHint');

            recordBtn.classList.remove('recording');
            recordHint.textContent = 'ÁÇπÂáªÂºÄÂßãÂΩïÈü≥ÔºàÊîØÊåÅ‰∏≠/Ëã±/Ëë°ËØ≠Ôºâ';

            recognition.stop();
        }

        // Handle speech result
        let finalTranscript = '';
        function handleSpeechResult(event) {
            let interimTranscript = '';

            for (let i = event.resultIndex; i < event.results.length; i++) {
                const transcript = event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    finalTranscript += transcript;
                } else {
                    interimTranscript += transcript;
                }
            }

            const originalText = document.getElementById('originalText');
            originalText.classList.remove('placeholder');
            originalText.textContent = finalTranscript + interimTranscript;

            // If we have final transcript, detect language and translate
            if (finalTranscript) {
                detectAndTranslate(finalTranscript);
                finalTranscript = '';
            }
        }

        // Handle speech error
        function handleSpeechError(event) {
            console.error('Speech recognition error:', event.error);
            stopRecording();

            let message = 'ËØ≠Èü≥ËØÜÂà´Âá∫Èîô';
            if (event.error === 'not-allowed') {
                message = 'ËØ∑ÂÖÅËÆ∏È∫¶ÂÖãÈ£éÊùÉÈôê';
            } else if (event.error === 'no-speech') {
                message = 'Êú™Ê£ÄÊµãÂà∞ËØ≠Èü≥';
            }
            showToast(message, 'error');
        }

        // Handle speech end
        function handleSpeechEnd() {
            if (isRecording) {
                // Restart if still recording
                recognition.start();
            }
        }

        // Detect language and translate to other two languages
        async function detectAndTranslate(text) {
            if (!text.trim()) return;

            const trans1Text = document.getElementById('trans1Text');
            const trans2Text = document.getElementById('trans2Text');

            trans1Text.classList.remove('placeholder');
            trans2Text.classList.remove('placeholder');
            trans1Text.textContent = 'ÁøªËØë‰∏≠...';
            trans2Text.textContent = 'ÁøªËØë‰∏≠...';

            try {
                const prompt = `You are a professional translator for airport operations in Angola. 

First, detect the language of the following text. It can be Chinese, English, or Portuguese.

Then translate it to the OTHER TWO languages (not the detected source language).

Text: "${text}"

Respond in this exact JSON format only, no other text:
{
  "detected": "zh" or "en" or "pt",
  "translations": {
    "zh": "Chinese translation or null if source is Chinese",
    "en": "English translation or null if source is English", 
    "pt": "Portuguese translation or null if source is Portuguese"
  }
}`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.2,
                            maxOutputTokens: 1024,
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                let resultText = data.candidates[0].content.parts[0].text.trim();

                // Clean up markdown code blocks if present
                resultText = resultText.replace(/```json\n?/g, '').replace(/```\n?/g, '');

                const result = JSON.parse(resultText);

                detectedLang = result.detected;

                // Update detected language display
                const detectedLangEl = document.getElementById('detectedLang');
                const detectedLangText = document.getElementById('detectedLangText');
                detectedLangEl.classList.remove('hidden');
                detectedLangText.textContent = `${langFlags[detectedLang]} ${langNames[detectedLang]}`;

                // Update original card
                const originalLangTag = document.getElementById('originalLangTag');
                originalLangTag.textContent = langNames[detectedLang];
                originalLangTag.className = 'lang-tag ' + detectedLang;

                // Determine which languages to show
                const otherLangs = ['zh', 'en', 'pt'].filter(l => l !== detectedLang);

                // Update translation cards
                const trans1LangTag = document.getElementById('trans1LangTag');
                const trans2LangTag = document.getElementById('trans2LangTag');
                const trans1Card = document.getElementById('trans1Card');
                const trans2Card = document.getElementById('trans2Card');

                // First translation
                trans1LangTag.textContent = langNames[otherLangs[0]];
                trans1LangTag.className = 'lang-tag ' + otherLangs[0];
                trans1Card.className = 'result-card translation-card ' + otherLangs[0];
                trans1Text.textContent = result.translations[otherLangs[0]] || '';

                // Second translation
                trans2LangTag.textContent = langNames[otherLangs[1]];
                trans2LangTag.className = 'lang-tag ' + otherLangs[1];
                trans2Card.className = 'result-card translation-card ' + otherLangs[1];
                trans2Text.textContent = result.translations[otherLangs[1]] || '';

                // Store current texts and langs for speaking
                currentTexts = {
                    original: text,
                    trans1: result.translations[otherLangs[0]] || '',
                    trans2: result.translations[otherLangs[1]] || ''
                };
                currentLangs = {
                    original: detectedLang,
                    trans1: otherLangs[0],
                    trans2: otherLangs[1]
                };

                // Add to history
                addToHistory(text, result.translations, detectedLang);

                // Auto speak if enabled
                if (autoSpeak) {
                    // Speak the first translation after a short delay
                    setTimeout(() => {
                        speakText('trans1');
                    }, 300);
                }

            } catch (error) {
                console.error('Translation error:', error);
                trans1Text.textContent = 'ÁøªËØëÂ§±Ë¥•ÔºåËØ∑ÈáçËØï';
                trans2Text.textContent = 'ÁøªËØëÂ§±Ë¥•ÔºåËØ∑ÈáçËØï';
                showToast('ÁøªËØëÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Add to history
        function addToHistory(original, translations, sourceLang) {
            const item = {
                id: Date.now(),
                original,
                translations,
                sourceLang,
                timestamp: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
            };

            history.unshift(item);
            if (history.length > 20) {
                history.pop();
            }

            saveHistory();
            renderHistory();
        }

        // Render history
        function renderHistory() {
            const historyList = document.getElementById('historyList');

            if (history.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <svg class="empty-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <p>ÊöÇÊó†ÁøªËØëËÆ∞ÂΩï</p>
                    </div>
                `;
                return;
            }

            historyList.innerHTML = history.map(item => {
                const otherLangs = ['zh', 'en', 'pt'].filter(l => l !== item.sourceLang);
                return `
                    <div class="history-item" onclick="loadHistoryItem(${item.id})">
                        <div class="history-original">${langFlags[item.sourceLang]} ${item.original}</div>
                        <div class="history-translations">
                            ${otherLangs.map(lang => `
                                <div class="history-trans-item">
                                    <span class="mini-tag lang-tag ${lang}">${langNames[lang]}</span>
                                    ${item.translations[lang] || ''}
                                </div>
                            `).join('')}
                        </div>
                        <div class="history-meta">
                            <span>${item.timestamp}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Load history item
        function loadHistoryItem(id) {
            const item = history.find(h => h.id === id);
            if (item) {
                const otherLangs = ['zh', 'en', 'pt'].filter(l => l !== item.sourceLang);

                // Update original
                document.getElementById('originalText').textContent = item.original;
                document.getElementById('originalText').classList.remove('placeholder');
                document.getElementById('originalLangTag').textContent = langNames[item.sourceLang];
                document.getElementById('originalLangTag').className = 'lang-tag ' + item.sourceLang;

                // Update detected language display
                document.getElementById('detectedLang').classList.remove('hidden');
                document.getElementById('detectedLangText').textContent = `${langFlags[item.sourceLang]} ${langNames[item.sourceLang]}`;

                // Update translations
                const trans1Text = document.getElementById('trans1Text');
                const trans2Text = document.getElementById('trans2Text');
                const trans1LangTag = document.getElementById('trans1LangTag');
                const trans2LangTag = document.getElementById('trans2LangTag');
                const trans1Card = document.getElementById('trans1Card');
                const trans2Card = document.getElementById('trans2Card');

                trans1Text.textContent = item.translations[otherLangs[0]] || '';
                trans1Text.classList.remove('placeholder');
                trans1LangTag.textContent = langNames[otherLangs[0]];
                trans1LangTag.className = 'lang-tag ' + otherLangs[0];
                trans1Card.className = 'result-card translation-card ' + otherLangs[0];

                trans2Text.textContent = item.translations[otherLangs[1]] || '';
                trans2Text.classList.remove('placeholder');
                trans2LangTag.textContent = langNames[otherLangs[1]];
                trans2LangTag.className = 'lang-tag ' + otherLangs[1];
                trans2Card.className = 'result-card translation-card ' + otherLangs[1];

                // Update current texts/langs for speaking
                currentTexts = {
                    original: item.original,
                    trans1: item.translations[otherLangs[0]] || '',
                    trans2: item.translations[otherLangs[1]] || ''
                };
                currentLangs = {
                    original: item.sourceLang,
                    trans1: otherLangs[0],
                    trans2: otherLangs[1]
                };
            }
        }

        // Save/Load history
        function saveHistory() {
            localStorage.setItem('translator_history', JSON.stringify(history));
        }

        function loadHistory() {
            const saved = localStorage.getItem('translator_history');
            if (saved) {
                history = JSON.parse(saved);
                renderHistory();
            }
        }

        function clearHistory() {
            history = [];
            saveHistory();
            renderHistory();
            showToast('ÂéÜÂè≤ËÆ∞ÂΩïÂ∑≤Ê∏ÖÁ©∫', 'success');
        }

        // Copy text
        function copyText(type) {
            const el = document.getElementById(type === 'original' ? 'originalText' : type + 'Text');
            const text = el.textContent;

            if (text && !el.classList.contains('placeholder')) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
                });
            }
        }

        // Speak text with visual feedback
        function speakText(type) {
            const text = currentTexts[type];
            const lang = currentLangs[type];

            if (!text) return;

            // Cancel any ongoing speech
            speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = langCodes[lang];
            utterance.rate = 0.9;

            // Get the button
            const btnId = type === 'original' ? 'originalSpeakBtn' : type + 'SpeakBtn';
            const btn = document.getElementById(btnId);

            utterance.onstart = () => {
                btn.classList.add('speaking');
            };

            utterance.onend = () => {
                btn.classList.remove('speaking');
            };

            utterance.onerror = () => {
                btn.classList.remove('speaking');
            };

            speechSynthesis.speak(utterance);
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');

            toastMessage.textContent = message;
            toast.className = 'toast ' + type;

            // Update icon
            const icon = toast.querySelector('.toast-icon');
            if (type === 'success') {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>';
            } else {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>';
            }

            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // API Key Modal
        function showApiKeyModal() {
            document.getElementById('apiKeyInput').value = apiKey;
            document.getElementById('apiKeyModal').classList.add('show');
        }

        function hideApiKeyModal() {
            document.getElementById('apiKeyModal').classList.remove('show');
        }

        function saveApiKey() {
            const input = document.getElementById('apiKeyInput');
            apiKey = input.value.trim();
            localStorage.setItem('gemini_api_key', apiKey);
            hideApiKeyModal();
            showToast('API Key Â∑≤‰øùÂ≠ò', 'success');
        }

        // Close modal on overlay click
        document.getElementById('apiKeyModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('apiKeyModal')) {
                hideApiKeyModal();
            }
        });
    </script>
</body>

</html>
